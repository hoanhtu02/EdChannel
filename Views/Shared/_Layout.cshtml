@using Microsoft.AspNetCore.Identity;
@using System.Linq;
@using System.Security.Claims;
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>@ViewData["Title"] - EdChannel</title>
    <meta name="robots" content="noindex, follow" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="~/images/favicon.png">

    <!-- CSS
    ============================================ -->
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="~/css/vendor/bootstrap.min.css">
    <link rel="stylesheet" href="~/css/vendor/font-awesome.css">
    <link rel="stylesheet" href="~/css/vendor/flaticon/flaticon.css">
    <link rel="stylesheet" href="~/css/vendor/slick.css">
    <link rel="stylesheet" href="~/css/vendor/slick-theme.css">
    <link rel="stylesheet" href="~/css/vendor/jquery-ui.min.css">
    <link rel="stylesheet" href="~/css/vendor/sal.css">
    <link rel="stylesheet" href="~/css/vendor/magnific-popup.css">
    <link rel="stylesheet" href="~/css/vendor/base.css">
    <link rel="stylesheet" href="~/css/style.min.css">
    <link rel="stylesheet" href="~/plugins/toastr/toatr.css">

</head>


<body>
    <!--[if lte IE 9]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->
    <a href="#top" class="back-to-top" id="backto-top"><i class="fal fa-arrow-up"></i></a>
    <input type="hidden" value="@ViewBag.CartId" id="uidCart" />
    <!-- Start Header -->
    <header class="header axil-header header-style-2">
        @if (!SignInManager.IsSignedIn(User))
        {
            <div class="header-top-campaign">
                <div class="container position-relative">
                    <div class="campaign-content">
                        <p>You are not logged in, if you do not have an account, you can register <a class="text-dark" asp-area="Identity" asp-page="/Account/Register">here</a>. 
                            If you already have one, <a asp-area="Identity" asp-page="/Account/Login">Login</a></p>
                    </div>
                </div>
                <button class="remove-campaign"><i class="fal fa-times"></i></button>
            </div>
        }
        <div class="header-top-campaign">
            <div class="container position-relative">
                <div class="campaign-content">
                    <div class="campaign-countdown"></div>
                    <p>Open Doors To A World Of Mobile Get <a href="#">Get Your Offer</a></p>
                </div>
            </div>
            <button class="remove-campaign"><i class="fal fa-times"></i></button>
        </div>
        <!-- Start Header Top Area  -->
        <div class="axil-header-top">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-2 col-sm-3 col-5">
                        <div class="header-brand">
                            <a href="index-2.html" class="logo logo-dark">
                                <img src="~/images/logo/logo.png" alt="Site Logo">
                            </a>
                            <a href="index-2.html" class="logo logo-light">
                                <img src="~/images/logo/logo-light.png" alt="Site Logo">
                            </a>
                        </div>
                    </div>
                    <div class="col-lg-10 col-sm-9 col-7">
                        <div class="header-top-dropdown dropdown-box-style">
                            <div class="axil-search">
                                <button type="submit" class="icon wooc-btn-search">
                                    <i class="far fa-search"></i>
                                </button>
                                <input type="search" class="placeholder product-search-input" name="search2" id="search2" value="" maxlength="128" placeholder="What are you looking for...." autocomplete="off">
                            </div>
                            <div class="dropdown">
                                <button class="dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    USD
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">USD</a></li>
                                    <li><a class="dropdown-item" href="#">AUD</a></li>
                                    <li><a class="dropdown-item" href="#">EUR</a></li>
                                </ul>
                            </div>
                            <div class="dropdown">
                                <button class="dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    EN
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">EN</a></li>
                                    <li><a class="dropdown-item" href="#">ARB</a></li>
                                    <li><a class="dropdown-item" href="#">SPN</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Header Top Area  -->
        <!-- Start Mainmenu Area  -->
        <div class="axil-mainmenu aside-category-menu">
            <div class="container">
                <div class="header-navbar">
                    <div class="header-nav-department">
                        <aside class="header-department">
                            <button class="header-department-text department-title">
                                <span class="icon"><i class="fal fa-bars"></i></span>
                                <span class="text">Categories</span>
                            </button>
                            <nav class="department-nav-menu">
                                <button class="sidebar-close"><i class="fas fa-times"></i></button>
                                <ul class="nav-menu-list">
                                    @if (ViewBag.Categories != null)
                                    {
                                        int count = 1;
                                        @foreach (var item in ViewBag.Categories)
                                        {
                                            bool temp = false;
                                            @foreach (var itemSub in ViewBag.SubCategories)
                                            {
                                                if (itemSub.ParentId == item.Id)
                                                {
                                                    temp = true;
                                                }
                                            }
                                            string classTemp = temp ? "has-megamenu" : "";
                                            <li>
                                                <a href="#" class="nav-link nav-link @classTemp ">
                                                    <span class="menu-icon">
                                                        <img src="~/images/product/categories/cat-0@(count).png" />
                                                        @* <img src="~/images/@item.Image" alt="Department"> *@
                                                    </span>
                                                    <span class="menu-text">@item.Title</span>
                                                </a>
                                                @if (temp)
                                                {
                                                    <div class="department-megamenu">
                                                        <div class="department-megamenu-wrap">
                                                            <div class="department-submenu-wrap">
                                                                <div class="department-submenu">
                                                                    <h3 class="submenu-heading"><a href="~/categories">@item.Title</a></h3>
                                                                    <ul>
                                                                        @if (ViewBag.SubCategories != null)
                                                                        {
                                                                            @foreach (var itemSub in ViewBag.SubCategories)
                                                                            {
                                                                                @if (itemSub.ParentId == item.Id)
                                                                                {
                                                                                    <li><a href="~/categories?sub=@itemSub.Slug">@itemSub.Title</a></li>
                                                                                }
                                                                            }
                                                                        }
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                            <div class="featured-product">
                                                                <h3 class="featured-heading">Featured</h3>
                                                                <div class="product-list">
                                                                    <div class="item-product">
                                                                        <a href="#"><img src="~/images/product/product-feature1.png" alt="Featured Product"></a>
                                                                    </div>
                                                                    <div class="item-product">
                                                                        <a href="#"><img src="~/images/product/product-feature2.png" alt="Featured Product"></a>
                                                                    </div>
                                                                    <div class="item-product">
                                                                        <a href="#"><img src="~/images/product/product-feature3.png" alt="Featured Product"></a>
                                                                    </div>
                                                                    <div class="item-product">
                                                                        <a href="#"><img src="~/images/product/product-feature4.png" alt="Featured Product"></a>
                                                                    </div>
                                                                </div>
                                                                <a href="#" class="axil-btn btn-bg-primary">See All Offers</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                            </li>
                                            count++;
                                        }
                                    }

                                </ul>
                            </nav>
                        </aside>
                    </div>
                    <div class="header-main-nav">
                        <!-- Start Mainmanu Nav -->
                        <nav class="mainmenu-nav">
                            <button class="mobile-close-btn mobile-nav-toggler"><i class="fas fa-times"></i></button>
                            <div class="mobile-nav-brand">
                                <a href="index-2.html" class="logo">
                                    <img src="~/images/logo/logo.png" alt="Site Logo">
                                </a>
                            </div>
                            <ul class="mainmenu">
                                <li><a asp-action="Index">Home</a></li>
                                <li><a href="/categories">Shop</a></li>
                                <li><a asp-action="Blog">Blog</a></li>
                                <li><a asp-action="About">About</a></li>
                                <li><a asp-action="Contact">Contact</a></li>
                            </ul>
                        </nav>
                        <!-- End Mainmanu Nav -->
                    </div>
                    <div class="header-action">
                        <ul class="action-list">
                            <li class="axil-search d-sm-none d-block">
                                <a href="javascript:void(0)" class="header-search-icon" title="Search">
                                    <i class="flaticon-magnifying-glass"></i>
                                </a>
                            </li>
                            <li class="wishlist">
                                <a href="wishlist.html">
                                    <i class="flaticon-heart"></i>
                                </a>
                            </li>
                            <li class="shopping-cart">
                                <a href="#" class="cart-dropdown-btn">
                                    <span class="cart-count">3</span>
                                    <i class="flaticon-shopping-cart"></i>
                                </a>
                            </li>
                            <li class="my-account">
                                <a href="javascript:void(0)">
                                    <i class="flaticon-person"></i>
                                </a>
                                <div class="my-account-dropdown">

                                    @if (!SignInManager.IsSignedIn(User))
                                    {
                                        <div class="login-btn">
                                            <a asp-area="Identity" asp-page="/Account/Login" class="axil-btn btn-bg-primary">Login</a>
                                        </div>
                                        <div class="reg-footer text-center">No account yet?
                                            <a class="btn-link" asp-area="Identity" asp-page="/Account/Register">REGISTER HERE.</a>
                                        </div>
                                    }else
                                    {

                                        <div class="title">Hello <h5 class="d-inline">@User.Identity?.Name!</h5></div>
                                        <ul>

                                            <li>
                                                <a asp-area="Home" asp-action="MyProfileDirect">My Account</a>
                                            </li>
                                            <li>
                                                <a href="#">Support</a>
                                            </li>
                                            <li>
                                                <a href="#">Language</a>
                                            </li>
                                        </ul>
                                        <div class="login-btn">
                                            <form asp-area="Identity" style="padding: 8px 15px;" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })" class="axil-btn btn-bg-primary">
                                                <button type="submit" class="axil-btn btn-bg-primary">Logout</button>
                                            </form>
                                        </div>
                                    }
                                </div>
                            </li>
                            <li class="axil-mobile-toggle">
                                <button class="menu-btn mobile-nav-toggler">
                                    <i class="flaticon-menu-2"></i>
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Mainmenu Area  -->
    </header>

    <main class="main-wrapper">
        @RenderBody()
    </main>


    <div class="service-area">
        <div class="container">
            <div class="row row-cols-xl-4 row-cols-sm-2 row-cols-1 row--20">
                <div class="col">
                    <div class="service-box service-style-2">
                        <div class="icon">
                            <img src="~/images/icons/service1.png" alt="Service">
                        </div>
                        <div class="content">
                            <h6 class="title">Fast &amp; Secure Delivery</h6>
                            <p>Tell about your service.</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="service-box service-style-2">
                        <div class="icon">
                            <img src="~/images/icons/service2.png" alt="Service">
                        </div>
                        <div class="content">
                            <h6 class="title">Money Back Guarantee</h6>
                            <p>Within 10 days.</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="service-box service-style-2">
                        <div class="icon">
                            <img src="~/images/icons/service3.png" alt="Service">
                        </div>
                        <div class="content">
                            <h6 class="title">24 Hour Return Policy</h6>
                            <p>No question ask.</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="service-box service-style-2">
                        <div class="icon">
                            <img src="~/images/icons/service4.png" alt="Service">
                        </div>
                        <div class="content">
                            <h6 class="title">Pro Quality Support</h6>
                            <p>24/7 Live support.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Start Footer Area  -->
    <footer class="axil-footer-area footer-style-2">
        <!-- Start Footer Top Area  -->
        <div class="footer-top separator-top">
            <div class="container">
                <div class="row">
                    <!-- Start Single Widget  -->
                    <div class="col-lg-3 col-sm-6">
                        <div class="axil-footer-widget">
                            <h5 class="widget-title">Support</h5>
                            <!-- <div class="logo mb--30">
                                <a href="index.html">
                                    <img class="light-logo" src="~/images/logo/logo.png" alt="Logo Images">
                                </a>
                            </div> -->
                            <div class="inner">
                                <p>
                                    685 Market Street, <br>
                                    Las Vegas, LA 95820, <br>
                                    United States.
                                </p>
                                <ul class="support-list-item">
                                    <li><a href="mailto:example@domain.com"><i class="fal fa-envelope-open"></i> example@domain.com</a></li>
                                    <li><a href="tel:(+01)850-315-5862"><i class="fal fa-phone-alt"></i> (+01) 850-315-5862</a></li>
                                    <!-- <li><i class="fal fa-map-marker-alt"></i> 685 Market Street,  <br> Las Vegas, LA 95820, <br> United States.</li> -->
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- End Single Widget  -->
                    <!-- Start Single Widget  -->
                    <div class="col-lg-3 col-sm-6">
                        <div class="axil-footer-widget">
                            <h5 class="widget-title">Account</h5>
                            <div class="inner">
                                <ul>
                                    <li><a href="my-account.html">My Account</a></li>
                                    <li><a href="sign-up.html">Login / Register</a></li>
                                    <li><a href="cart.html">Cart</a></li>
                                    <li><a href="wishlist.html">Wishlist</a></li>
                                    <li><a href="shop.html">Shop</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- End Single Widget  -->
                    <!-- Start Single Widget  -->
                    <div class="col-lg-3 col-sm-6">
                        <div class="axil-footer-widget">
                            <h5 class="widget-title">Quick Link</h5>
                            <div class="inner">
                                <ul>
                                    <li><a href="privacy-policy.html">Privacy Policy</a></li>
                                    <li><a href="terms-of-service.html">Terms Of Use</a></li>
                                    <li><a href="#">FAQ</a></li>
                                    <li><a href="contact.html">Contact</a></li>
                                    <li><a href="contact.html">Contact</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- End Single Widget  -->
                    <!-- Start Single Widget  -->
                    <div class="col-lg-3 col-sm-6">
                        <div class="axil-footer-widget">
                            <h5 class="widget-title">Download App</h5>
                            <div class="inner">
                                <span>Save $3 With App & New User only</span>
                                <div class="download-btn-group">
                                    <div class="qr-code">
                                        <img src="~/images/others/qr.png" alt="Axilthemes">
                                    </div>
                                    <div class="app-link">
                                        <a href="#">
                                            <img src="~/images/others/app-store.png" alt="App Store">
                                        </a>
                                        <a href="#">
                                            <img src="~/images/others/play-store.png" alt="Play Store">
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Single Widget  -->
                </div>
            </div>
        </div>
        <!-- End Footer Top Area  -->
        <!-- Start Copyright Area  -->
        <div class="copyright-area copyright-default separator-top">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xl-4">
                        <div class="social-share">
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                            <a href="#"><i class="fab fa-discord"></i></a>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-12">
                        <div class="copyright-left d-flex flex-wrap justify-content-center">
                            <ul class="quick-link">
                                <li>© 2023. All rights reserved by <a target="_blank" href="https://axilthemes.com/">Axilthemes</a>.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-12">
                        <div class="copyright-right d-flex flex-wrap justify-content-xl-end justify-content-center align-items-center">
                            <span class="card-text">Accept For</span>
                            <ul class="payment-icons-bottom quick-link">
                                <li><img src="~/images/icons/cart/cart-1.png" alt="paypal cart"></li>
                                <li><img src="~/images/icons/cart/cart-2.png" alt="paypal cart"></li>
                                <li><img src="~/images/icons/cart/cart-5.png" alt="paypal cart"></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Copyright Area  -->
    </footer>
    <!-- End Footer Area  -->
    <!-- Product Quick View Modal Start -->
    <div class="modal fade quick-view-product" id="quick-view-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content productsItem">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i class="far fa-times"></i></button>
                </div>
                <div class="modal-body">
                    <div class="single-product-thumb">
                        <div class="row">
                            <div class="col-lg-7 mb--40">
                                <div class="row">
                                    <div class="col-lg-10 order-lg-2">
                                        <div class="single-product-thumbnail product-large-thumbnail axil-product thumbnail-badge zoom-gallery">
                                            <div class="thumbnail">
                                                <img src="~/images/product/product-big-01.png" style="width: 441px; height: 441px; object-fit: contain;" class="imgThumbP" alt="Product Images">
                                                <div class="label-block label-right">
                                                    <div class="product-badget dicountProductP">20% OFF</div>
                                                </div>
                                                <div class="product-quick-view position-view">
                                                    <a href="~/images/product/product-big-01.png" class="popup-zoom imgPopupP">
                                                        <i class="far fa-search-plus"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5 mb--40">
                                <div class="single-product-content">
                                    <div class="inner">
                                        <h3 class="product-title proTitlePopupP">Serif Coffee Table</h3>
                                        <span class="price-amount proAmountPopupP">$155.00 - $255.00</span>
                                        <ul class="product-meta">
                                            <li><i class="fal fa-check"></i>In stock</li>
                                            <li><i class="fal fa-check"></i>Free delivery available</li>
                                            <li><i class="fal fa-check"></i>Sales 30% Off Use Code: MOTIVE30</li>
                                        </ul>
                                        <p class="description proDesPopupP">In ornare lorem ut est dapibus, ut tincidunt nisi pretium. Integer ante est, elementum eget magna. Pellentesque sagittis dictum libero, eu dignissim tellus.</p>


                                        <!-- Start Product Action Wrapper  -->
                                        <div class="product-action-wrapper d-flex-center">
                                            <!-- Start Quentity Action  -->
                                            <div class="pro-qty">
                                                <span class="dec qtybtn">-</span>
                                                <input type="number" class="quantity-input" value="1">
                                                <span class="inc qtybtn">+</span>
                                            </div>
                                            <!-- End Quentity Action  -->
                                            <!-- Start Product Action  -->
                                            <ul class="product-action d-flex-center mb--0">
                                                <li class="add-to-cart"><a href="javascript:void(0);" class="axil-btn btn-bg-primary btnAddToCartP">Add to Cart</a></li>
                                                <li class="wishlist"><a href="javascript:void(0);" class="axil-btn wishlist-btn btnAddToWishListP"><i class="far fa-heart"></i></a></li>
                                            </ul>
                                            <!-- End Product Action  -->

                                        </div>
                                        <!-- End Product Action Wrapper  -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Product Quick View Modal End -->
    <!-- Header Search Modal End -->
    <div class="header-search-modal" id="header-search-modal">
        <button class="card-close sidebar-close"><i class="fas fa-times"></i></button>
        <div class="header-search-wrap">
            <div class="card-header">
                <form action="#">
                    <div class="input-group">
                        <input type="search" class="form-control" name="prod-search" id="prod-search" placeholder="Write Something....">
                        <button type="submit" class="axil-btn btn-bg-primary"><i class="far fa-search"></i></button>
                    </div>
                </form>
            </div>
            <div class="card-body">
                <div class="search-result-header">
                    <h6 class="title">24 Result Found</h6>
                    <a href="shop.html" class="view-all">View All</a>
                </div>
                <div class="psearch-results">
                    <div class="axil-product-list">
                        <div class="thumbnail">
                            <a href="single-product.html">
                                <img src="~/images/product/electric/product-09.png" alt="Yantiti Leather Bags">
                            </a>
                        </div>
                        <div class="product-content">
                            <div class="product-rating">
                                <span class="rating-icon">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fal fa-star"></i>
                                </span>
                                <span class="rating-number"><span>100+</span> Reviews</span>
                            </div>
                            <h6 class="product-title"><a href="single-product.html">Media Remote</a></h6>
                            <div class="product-price-variant">
                                <span class="price current-price">$29.99</span>
                                <span class="price old-price">$49.99</span>
                            </div>
                            <div class="product-cart">
                                <a href="cart.html" class="cart-btn"><i class="fal fa-shopping-cart"></i></a>
                                <a href="wishlist.html" class="cart-btn"><i class="fal fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="axil-product-list">
                        <div class="thumbnail">
                            <a href="single-product.html">
                                <img src="~/images/product/electric/product-09.png" alt="Yantiti Leather Bags">
                            </a>
                        </div>
                        <div class="product-content">
                            <div class="product-rating">
                                <span class="rating-icon">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fal fa-star"></i>
                                </span>
                                <span class="rating-number"><span>100+</span> Reviews</span>
                            </div>
                            <h6 class="product-title"><a href="single-product.html">Media Remote</a></h6>
                            <div class="product-price-variant">
                                <span class="price current-price">$29.99</span>
                                <span class="price old-price">$49.99</span>
                            </div>
                            <div class="product-cart">
                                <a href="cart.html" class="cart-btn"><i class="fal fa-shopping-cart"></i></a>
                                <a href="wishlist.html" class="cart-btn"><i class="fal fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Header Search Modal End -->


    <div class="cart-dropdown" id="cart-dropdown">
        <div class="cart-content-wrap">
            <div class="cart-header">
                <h2 class="header-title">Cart review</h2>
                <button class="cart-close sidebar-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="cart-body">
                <ul class="cart-item-list">
                </ul>
            </div>
            <div class="cart-footer">
                <h3 class="cart-subtotal">
                    <span class="subtotal-title">Subtotal:</span>
                    <span class="subtotal-amount">$610.00</span>
                </h3>
                <div class="group-btn">
                    <a href="/carts" class="axil-btn btn-bg-primary viewcart-btn">View Cart</a>
                    <a href="/checkout" class="axil-btn btn-bg-secondary checkout-btn ">Checkout</a>
                </div>
            </div>
        </div>
    </div>


    <!-- JS
    ============================================ -->
    <!-- Modernizer JS -->
    <script src="~/js/vendor/modernizr.min.js"></script>
    <!-- jQuery JS -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="~/js/vendor/popper.min.js"></script>
    <script src="~/js/vendor/bootstrap.min.js"></script>
    <script src="~/js/vendor/slick.min.js"></script>
    <script src="~/js/vendor/js.cookie.js"></script>
     @* <script src="~/js/vendor/jquery.style.switcher.js"></script>  *@
    <script src="~/js/vendor/jquery-ui.min.js"></script>
    <script src="~/js/vendor/jquery.ui.touch-punch.min.js"></script>
    <script src="~/js/vendor/jquery.countdown.min.js"></script>
    <script src="~/js/vendor/sal.js"></script>
    <script src="~/js/vendor/jquery.magnific-popup.min.js"></script>
    <script src="~/js/vendor/imagesloaded.pkgd.min.js"></script>
    <script src="~/js/vendor/isotope.pkgd.min.js"></script>
    <script src="~/js/vendor/counterup.js"></script>
    <script src="~/js/vendor/waypoints.min.js"></script>
    <script src="~/plugins/toastr/toastr.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/main.js"></script>


    <script>
        const cartId = document.querySelector("#uidCart").value
        toastr.options = {
            "newestOnTop": true,
            "positionClass": "toast-top-right",
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "showMethod": "fadeIn",
            "hideEasing": "linear",
            "hideMethod": "fadeOut"
        }
        let cart = []
        ajax(`/api/carts/${cartId}`, "GET", null, function (res) {
                console.log(res)
            cart = [...res]
            renderCart(cart)
            calcAmount(cart)
        }, function (err) {
            console.log(err)
        })
        let preId = ""
        const cartList = document.querySelector(".cart-item-list")
        function renderCart(arr) {
            cartList.innerHTML = ""
           cartList.insertAdjacentHTML("beforeend", arr.reduce((pre, curr) => pre += `
                        <li class="cart-item" data-id="${curr.Product.Id}">
                    <div class="item-img">
                                        <a href="/products/${curr.Product.Slug}"><img src="/images/${curr.Product.Image}" alt="Commodo Blown Lamp"></a>
                        <button class="close-btn"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="item-content">
                                                <h3 class="item-title"><a href="/products/${curr.Product.Slug}">${curr.Product.Title}</a></h3>
                                        <div class="item-price"><span class="currency-symbol">$</span>${curr.Product.Price}</div>
                                <div class="pro-qty item-quantity">
                                <span class="dec qtybtn">-</span>
                                                    <input type="number" class="quantity-input" value="${curr.Quantity}">
                                <span class="inc qtybtn">+</span>
                        </div>
                    </div>
                </li>`, ''))

            calcAmount(arr)
            document.querySelector(".shopping-cart .cart-count").style.display = "block"
            if (arr.length > 0) document.querySelector(".shopping-cart .cart-count").textContent = arr.length
            else document.querySelector(".shopping-cart .cart-count").style.display = "none"
        }
        function calcAmount(arr) {
            document.querySelector(".cart-content-wrap .subtotal-amount").innerHTML = arr.reduce((pre, curr) => pre += curr.Quantity * curr.Product.Price, 0) + "$"
        }
        document.querySelector(".cart-item-list").addEventListener("click", debounce(e => {
            const qtybtn = e.target.closest(".qtybtn")
            const btnDelPro = e.target.closest(".close-btn")
            if (qtybtn) {
                let idProduct = qtybtn.closest("li").dataset.id
                let oldValue = qtybtn.parentNode.querySelector('input').value;
                let newVal = 0
                if (qtybtn.classList.contains('inc')) {
                    newVal = parseFloat(oldValue) + 1;
                } else {
                    if (oldValue > 0) {
                        newVal = parseFloat(oldValue) - 1;
                    } else {
                        newVal = 0;
                    }
                }
                cart.find(val => String(val.Product.Id) === idProduct).Quantity = newVal
                calcAmount(cart)
                qtybtn.parentNode.querySelector('input').value = newVal;
                ajax(`/api/add-cart/${cartId}/add`, "POST", { ProductId: idProduct, Quantity: newVal }, function (res) {
                        toastr.success('Cập nhật số lượng thành công!', "Thông báo")
                }, function (err) {
                    console.log(err)
                    toastr.error('Cập nhật thất bại!', "Thông báo")
                })
            }
            if (btnDelPro) {
                let product = btnDelPro.closest("li")
                console.log(product)
                let idPo = product.dataset.id
                cart = cart.filter(val => String(val.Product.Id) !== idPo)
                document.querySelector(".cart-item-list").removeChild(product)
                calcAmount(cart)
                document.querySelector(".shopping-cart .cart-count").textContent = cart.length
                ajax(`/api/remove-cart/${cartId}/remove`, "DELETE", { ProductId: +idPo }, function (res) {
                        toastr.success('Xóa thành công!', "Thông báo")
                }, function (err) {
                    console.log(err)
                    toastr.error('Xóa thất bại!', "Thông báo")
                })
            }
        }, 500))
        let dataSiglePro = {}
        let currPreviewId = ""

        document.querySelector(".cart-item-list").addEventListener("input", debounce(e => {
            const input = e.target.closest(".quantity-input")
            if (input) {
                let idProduct = input.closest("li").dataset.id
                let newVal = input.value
                cart.find(val => String(val.Product.Id) === idProduct).Quantity = newVal
                calcAmount(cart)
                ajax(`/api/add-cart/${cartId}/add`, "POST", { ProductId: idProduct, Quantity: newVal }, function (res) {
                        toastr.success('Cập nhật số lượng thành công!', "Thông báo")
                }, function (err) {
                    console.log(err)
                    toastr.error('Cập nhật thất bại!', "Thông báo")
                })
            }
        }, 2000, false))
        document.querySelectorAll(".listProduct")?.forEach((pro) => pro.addEventListener("click", debounce(async (e) => {
            e.stopPropagation()
            const btnAddCart = e.target.closest(".btnAddToCart")
            if (btnAddCart) {
                const container = btnAddCart.closest(".productsItem")
                const imgPro = container.querySelector(".imgThumb").src.split("/").at(-1)
                const discount = container.querySelector(".disountProduct")?.textContent.split("%")[0] || "0"
                const price = container.querySelector(".proAmountPopup").textContent.slice(1)
                const title = container.querySelector(".proTitlePopup").textContent
                const Slug = container.querySelector(".thumbnailPro").href.split("/").at(-1)
                const Id = container.querySelector(".btnAddToCart").getAttribute("data-id")
                const itemToPush = { Id, Image: imgPro, Discount: discount, Price: price, Title: title, Quantity: 1, Slug }
                console.log(container)
                if (cart.some(val => String(val.Product.Id) === String(itemToPush.Id))) {
                    const itemToUpdate = cart.find(val => String(val.Product.Id) === String(itemToPush.Id));
                    if (itemToUpdate) {
                        // cart.find(val => String(val.Id) === String(itemToPush.Id)).Quantity = Number(itemToUpdate.Quantity) + 1;
                        toastr.info('Sản phẩm đã có trong giỏ hàng', "Thông báo")
                    }
                } else {
                    cart.push({ Product: { ...itemToPush }, Quantity: 1 })
                    ajax(`/api/add-cart/${cartId}/add`, "POST", { ProductId: +Id, Quantity: 1 }, function (res) {
                        toastr.success('Thêm thành công!', "Thông báo")
                    }, function (err) {
                        console.log(err)
                        toastr.error('Thêm thất bại!', "Thông báo")
                    })
                }
                renderCart(cart)
                calcAmount(cart)
                return
            }
            const viewModal = e.target.closest(".quickview>a")
            if (!viewModal && !viewModal?.dataset.id) return;
            if (viewModal.dataset.id === preId) return;
            let click = false
            preId = viewModal.dataset.id;
            const result = await fetch(`/api/products/${viewModal.dataset.id}`)
            const data = await result.json()
            dataSiglePro = data
            currPreviewId = viewModal.dataset.id
            const container = document.querySelector("#quick-view-modal")
            container.querySelector(".imgThumbP").src = container.querySelector(".imgPopupP").href = "/images/" + data.Image
            container.querySelector(".dicountProductP").textContent = data.Discount + "% OFF"
            container.querySelector(".proAmountPopupP").textContent = "$" + (data.Price - data.Price * data.Discount / 100);
            container.querySelector(".proTitlePopupP").textContent = data.Title
            container.querySelector(".proDesPopupP").textContent = data.Details
            container.querySelector(".btnAddToCartP").setAttribute("data-id", data.Id)
            container.querySelector(".btnAddToWishListP").setAttribute("data-id", data.Id)
            container.querySelector('.pro-qty input').value = 1;
        }, 500)))
        document.querySelector("#quick-view-modal").addEventListener("click", (e) => {
            e.stopPropagation();
            e.preventDefault();
            const qtybtn = e.target.closest(".qtybtn")
            const container = document.querySelector("#quick-view-modal")
            const btnAddToCart = e.target.closest(".btnAddToCartP")
            if (qtybtn) {
                let newVal = 0;
                let oldValue = qtybtn.parentNode.querySelector('input').value;
                console.log(oldValue)
                console.log(newVal)
                if (qtybtn.classList.contains('inc')) {
                    newVal = parseFloat(oldValue) + 1;
                } else {
                    if (parseFloat(oldValue) > 0) {
                        newVal = parseFloat(oldValue) - 1;
                    } else {
                        newVal = 0;
                    }
                }
                qtybtn.parentNode.querySelector('input').value = newVal;
                newVal = 0
            }
            if (btnAddToCart) {
                if (dataSiglePro.Discount) dataSiglePro.Price -= dataSiglePro.Price * dataSiglePro.Discount / 100
                if (!cart.some(val => String(val.Product.Id) === String(currPreviewId))) {
                    cart.push({ Product: { ...dataSiglePro }, Quantity: container.querySelector('.pro-qty input').value })
                }
                else {
                    cart.find(val => String(val.Product.Id) === String(currPreviewId)).Quantity = Number(cart.find(val => String(val.Product.Id) === String(currPreviewId)).Quantity) + Number(container.querySelector('.pro-qty input').value)
                }
                ajax(`/api/add-cart/${cartId}/add`, "POST", { ProductId: currPreviewId, Quantity: Number(cart.find(val => String(val.Product.Id) === String(dataSiglePro.Id)).Quantity) + Number(container.querySelector('.pro-qty input').value) }, function (res) {
                    toastr.success('Thêm thành công!', "Thông báo")
                }, function (err) {
                    console.log(err)
                    toastr.error('Thêm thất bại!', "Thông báo")
                })
                calcAmount(cart)
                renderCart(cart)
                container.querySelector('.pro-qty input').value = 1
                container.querySelector(".btn-close").click()
            }
        })
    </script>
    <!-- Main JS -->
    @await RenderSectionAsync("Scripts", required: false)

</body>


</html>
